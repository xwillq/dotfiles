command brew "$@"

local result=$?

# Finish execution if command failed or was executed for completions
if [ $result -ne 0 ] || grep -q 'complete' <<<$funcstack && grep -q 'services' <<<$funcstack; then
    exit $result
fi

local dump_commands=(
    install
    tap
    uninstall remove rm
    untap
)
local main_command="$1"

if [ $dump_commands[(Ie)$main_command] -ne 0 ]; then
    echo "\033[1;34m==>\033[0m Running \`brew bundle dump\`..."
    HOMEBREW_NO_AUTO_UPDATE=1 command brew bundle dump --global --force --all --describe
fi
